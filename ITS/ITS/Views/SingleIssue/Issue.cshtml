@model ITS.Domain.Entities.Issue
@using Microsoft.AspNet.Identity

@{
    ViewBag.Title = "Issue";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    label, input { display:block; }
    input.text { margin-bottom:12px; width:95%; padding: .4em; }
    div.comment {
        border:none;
        /*border-color: black;
        border-width: 1px;*/
    }

    div.single-comment {
        border:solid;
        border-color: green;
        border-width: 2px;
    }

</style>


    <h2>@Model.Title</h2>

    <h3>@Model.Description</h3>

@{
    Html.RenderPartial("~/Views/Shared/_IssuePartial.cshtml", Model);
}
<div class="sidecontent">
    <a class="modalorder" href="#">
        Edit details        
    </a>

</div>

<div class="Comments">
    @foreach (var x in Model.Comments.Reverse())
    {
        <div class="single-comment">
            <div class="comment-title">
                Created by @x.CommentChanges.First(y => y.TypeOfChange == "CREATION").UserEmail
            </div>
            <div>
                Modified last time by @x.CommentChanges.OrderByDescending(y => y.TimeOfChange).First().UserEmail
            </div>
            <div class="comment">@x.Text</div>
            <div class="comment-edit" style="display:none" id="comment-edit_@(x.Id)">
                @Html.Partial("ModifyComment", new ITS.Models.CommentViewModel()
           {
               Comment = x,
               UserEmail = User.Identity.GetUserName()
           })
            </div>
            <input type="button" id="edit-btn-@(x.Id)" value="Edit" onclick="toggle_visibility(@(x.Id))" />
            <input type="button" id="cancel-btn-@(x.Id)" value="Cancel" onclick="toggle_visibility(@(x.Id))" style="display:none" />
        </div>
    }
    <a id="addComment" href="#"> Add Comment </a>
</div>

@Html.Partial("AddComment", new ITS.Models.CommentViewModel() {Comment = 
new ITS.Domain.Entities.Comment() { IssueId = @Model.Id },
UserEmail = User.Identity.GetUserName()})

@section Scripts
{
<script type="text/javascript">
    function toggle_visibility(id) {
        var e = document.getElementById('comment-edit_' + id);
        var eBtn = document.getElementById('edit-btn-' + id);
        var cBtn = document.getElementById('cancel-btn-' + id);
        if (e.style.display == 'block') {
            e.style.display = 'none';
            eBtn.style.display = 'block';
            cBtn.style.display = 'none';
        }
        else {
            e.style.display = 'block';
            eBtn.style.display = 'none';
            cBtn.style.display = 'block';
        }
    }

    $(function () {
        console.log("HELLO");
        var dial;
        dial = $(".order_bg").dialog({
            height: 400,
            width: 350,
            modal: true,
            autoOpen: false,
            buttons: {
                "Apply": function () {
                    console.log("Submitting");
                    document.getElementById("sForm").submit();
                },
                "Cancel": function() {
                    dial.dialog("close");
                }
            }                        
        });

        var addComm;
        addComm = $("#add-comment").dialog({
            height: 400,
            width: 350,
            modal: true,
            autoOpen: false,
            buttons: {
                "Add": function () {
                    console.log("Submitting");
                    document.getElementById("acForm").submit();
                },
                "Cancel": function () {
                    addComm.dialog("close");
                }
            }
        });

        $(".modalorder").button().on("click", function () {
            dial.dialog("open");
            console.log("EDIT ISSUE CLICKED");
        });

        $("#addComment").button().on("click", function () {
            addComm.dialog("open");
            console.log("ADD COMMENT CLICKED");
        });
    });
</script>
}